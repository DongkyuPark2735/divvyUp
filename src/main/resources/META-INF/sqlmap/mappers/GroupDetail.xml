<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.lec.divvyup.dao.GroupDetailDao">
	<resultMap type="GroupDetail" id="GroupDetailResult">
		<result property="gdid" column="gdid"/>
		<result property="gid" column="gid"/>
		<result property="mid" column="mid"/>
		<result property="gdbalancce" column="gdbalancce"/>
	</resultMap>
	
	<!-- 그룹에 멤버 추가 -->
	<insert id="insertGroupDetail" parameterType="GroupDetail">
    	<![CDATA[
			INSERT INTO GROUPDETAIL (GDID, GID, MID, GDBALANCE)
        		VALUES (GROUPDETAIL_SEQ.NEXTVAL, (SELECT MAX(GID) FROM GROUPS), #{mid}, 0)
        ]]>
	</insert>
	
	<!-- STEP 3 OF ADDING EVENT : 새 이벤트 진행시, GROUPDETAIL에 멤버 정보를 업데이트 해준다 -->
	<update id="updateGroupDetail">
		UPDATE GROUPDETAIL GD
  		SET GDBALANCE = GDBALANCE + (SELECT EDSHARE FROM EVENTDETAIL ED WHERE ED.MID = GD.MID AND EID=(SELECT MAX(EID) FROM EVENT))
	</update>
	
	
	<select id="groupDetailList" resultType="GroupDetail" parameterType="int">
		SELECT * FROM GROUPDETAIL WHERE GID=#{gid}
	</select>
	
</mapper>