
--DROPPING QUERY'S
DROP TABLE MEMBER CASCADE CONSTRAINTS;
DROP SEQUENCE GROUPS_SEQ;
DROP TABLE GROUPS CASCADE CONSTRAINTS;
DROP SEQUENCE GROUPDETAIL_SEQ;
DROP TABLE GROUPDETAIL CASCADE CONSTRAINTS;
DROP SEQUENCE EVENT_SEQ;
DROP TABLE EVENT CASCADE CONSTRAINTS;
DROP SEQUENCE EVENTDETAIL_SEQ;
DROP TABLE EVENTDETAIL CASCADE CONSTRAINTS;
DROP SEQUENCE EVENTHISTORY_SEQ;
DROP TABLE EVENTHISTORY CASCADE CONSTRAINTS;
DROP SEQUENCE CENTRALSYSTEM_SEQ;
DROP TABLE CENTRALSYSTEM CASCADE CONSTRAINTS;
DROP SEQUENCE GROUPBOARD_SEQ;
DROP TABLE GROUPBOARD CASCADE CONSTRAINTS;
DROP SEQUENCE ABOARD_SEQ;
DROP TABLE ABOARD CASCADE CONSTRAINTS;
DROP TABLE ADMIN CASCADE CONSTRAINTS;

--SELECT QUERYS

SELECT * FROM  MEMBER;
SELECT * FROM  GROUPS;
SELECT * FROM  GROUPDETAIL;
SELECT * FROM  EVENT;
SELECT * FROM  EVENTDETAIL;
SELECT * FROM  EVENTHISTORY;
SELECT * FROM  CENTRALSYSTEM;  
SELECT * FROM GROUPBOARD;
SELECT * FROM QBOARD;
SELECT * FROM ABOARD;
SELECT * FROM ADMIN;

SELECT M.MID FROM MEMBER M, GROUPS G WHERE M.MID != G.MID AND GD.GID=G.GID AND GD.GID=#{gid}
-- [1] MEMBER TABLE --

DROP TABLE MEMBER CASCADE CONSTRAINTS;

 DELETE FROM EVENTDETAIL WHERE EID=(SELECT MAX(EID) FROM EVENT);
 commit;
CREATE TABLE MEMBER(
    MID VARCHAR2(100) PRIMARY KEY,
    MPW VARCHAR2(100) NOT NULL,
    MNAME VARCHAR2(100) NOT NULL,
    MEMAIL VARCHAR2(100) NOT NULL,
    MRDATE DATE DEFAULT SYSDATE NOT NULL);
        
COMMIT;

SELECT NVL((MAX(GID)+1 FROM GROUPS), 1);
--[2] GROUPS TABLE --

DROP SEQUENCE GROUPS_SEQ;

CREATE SEQUENCE GROUPS_SEQ MAXVALUE 99999999 NOCYCLE NOCACHE;

DROP TABLE GROUPS CASCADE CONSTRAINTS;

CREATE TABLE GROUPS(
    GID NUMBER(6) DEFAULT 1 PRIMARY KEY ,
    GNAME VARCHAR2(100),
    GRDATE DATE DEFAULT SYSDATE,
    GIMG VARCHAR2(100),
    GCONTENT VARCHAR2(4000),
    MID VARCHAR2(100) REFERENCES MEMBER(MID));
  
COMMIT;       

-- [3] GROUP DETAIL -- 

DROP SEQUENCE GROUPDETAIL_SEQ;

CREATE SEQUENCE GROUPDETAIL_SEQ MAXVALUE 99999999 NOCYCLE NOCACHE;
    
DROP TABLE GROUPDETAIL;

CREATE TABLE GROUPDETAIL( -- info about the members in the group
    GDID NUMBER(6) PRIMARY KEY, -- The member's unique ID WITHIN THE GROUP
    GID NUMBER(6) REFERENCES GROUPS(GID), -- group ID to distinguish the groups
    MID VARCHAR2(100) REFERENCES MEMBER(MID), -- member ID to link member's information
    GDBALANCE NUMBER(15) DEFAULT 0,
    GDRDATE DATE DEFAULT SYSDATE); -- date member joined the group

COMMIT;

-- [4] EVENT -- 

DROP SEQUENCE EVENT_SEQ;

CREATE SEQUENCE EVENT_SEQ MAXVALUE 99999999 NOCYCLE NOCACHE;

DROP TABLE EVENT CASCADE CONSTRAINTS;

CREATE TABLE EVENT(
    EID NUMBER(6) PRIMARY KEY,
    ENAME VARCHAR2(100) NOT NULL, --title for payment
    ECONTENT VARCHAR(4000), -- description of payment: eg. taxi cost, dinner...
    EIMAGE VARCHAR2(100), -- image attached relating to payment : eg. receit
    EAMOUNT NUMBER(15) NOT NULL,--total amount paid
    EADDRESS VARCHAR(300),
    ECOUNT NUMBER(3) NOT NULL, --total number of people in the group
    ERDATE DATE DEFAULT SYSDATE, --date of payment
    MID VARCHAR2(100) REFERENCES MEMBER(MID) NOT NULL, --person who paid
    GID NUMBER(6) REFERENCES GROUPS(GID) NOT NULL); -- the group in which the payment was made in

COMMIT;

-- [5] EVENT DETAIL --

DROP SEQUENCE EVENTDETAIL_SEQ;

CREATE SEQUENCE EVENTDETAIL_SEQ MAXVALUE 99999999 NOCYCLE NOCACHE;

DROP TABLE EVENTDETAIL CASCADE CONSTRAINTS; 

CREATE TABLE EVENTDETAIL(
    EDID NUMBER(6) PRIMARY KEY, -- The member's unique ID WITHIN THE PAYMENT
    EID NUMBER(6) REFERENCES EVENT(EID) NOT NULL, -- which payment the member is involved in
    MID VARCHAR2(100)   REFERENCES MEMBER(MID) NOT NULL, --member that was involved in this payment
    EDSHARE NUMBER(10) DEFAULT 0 NOT NULL); -- (the share) amount the member has to pay (calculate using inner join)

COMMIT;

-- [6] EVENTHISTORY  --

DROP SEQUENCE EVENTHISTORY_SEQ;

CREATE SEQUENCE EVENTHISTORY_SEQ MAXVALUE 99999999 NOCYCLE NOCACHE;

DROP TABLE EVENTHISTORY;

CREATE TABLE EVENTHISTORY (
    EHID NUMBER(6) PRIMARY KEY,
    EID NUMBER(6) REFERENCES EVENT(EID) NOT NULL,
    MID VARCHAR2(100)  REFERENCES MEMBER(MID) NOT NULL,
    EDSHARE NUMBER(10),
    ERDATE DATE NOT NULL,
    ENAME VARCHAR2(100) NOT NULL);
    
COMMIT;

-- [7] CENTRALSYSTEM  --

DROP SEQUENCE CENTRALSYSTEM_SEQ;

CREATE SEQUENCE CENTRALSYSTEM_SEQ MAXVALUE 99999999 NOCYCLE NOCACHE;

DROP TABLE CENTRALSYSTEM;

CREATE TABLE CENTRALSYSTEM (
    CSID NUMBER(6) PRIMARY KEY,
    CSAMOUNT NUMBER(15) DEFAULT 0 NOT NULL,  --temporary varaible that continous to change
    CSALLPAID NUMBER(1) DEFAULT 0 NOT NULL,
    GID NUMBER(6) REFERENCES GROUPS(GID) NOT NULL);

SELECT * FROM CENTRALSYSTEM;

COMMIT;

--  [8] GROUPBOARD  --

DROP SEQUENCE GROUPBOARD_SEQ;

CREATE SEQUENCE GROUPBOARD_SEQ NOCYCLE NOCACHE;

DROP TABLE GROUPBOARD;

CREATE TABLE GROUPBOARD(
    GBID NUMBER(10) PRIMARY KEY,
    GID NUMBER(6) REFERENCES GROUPS(GID) NOT NULL,
    MID VARCHAR2(100) REFERENCES MEMBER(MID) NOT NULL,
    GBCONTENT VARCHAR2(4000),
    GBFILENAME VARCHAR2(1000),
    GBRDATE TIMESTAMP DEFAULT SYSDATE);

--  [9] QBOARD  --

DROP SEQUENCE QBOARD_SEQ;

CREATE SEQUENCE QBOARD_SEQ MAXVALUE 9999999999 NOCYCLE NOCACHE;

DROP TABLE GROUPBOARD;

CREATE TABLE QBOARD(
    QBID NUMBER(10) PRIMARY KEY,
    MID VARCHAR2(100) REFERENCES MEMBER(MID) NOT NULL,
    QBTITLE VARCHAR2(1000) NOT NULL,
    QBCONTENT VARCHAR2(4000),
    QBRDATE DATE DEFAULT SYSDATE NOT NULL,
    QBIP VARCHAR2(20) NOT NULL,
    QBREPLYCHECK NUMBER(1) DEFAULT 0 NOT NULL);

--  [10] QBOARD  --

DROP SEQUENCE ABOARD_SEQ;

CREATE SEQUENCE ABOARD_SEQ MAXVALUE 9999999999 NOCYCLE NOCACHE;

DROP TABLE ABOARD;

CREATE TABLE ABOARD(
    ABID NUMBER(10) PRIMARY KEY,
    AID VARCHAR2(100) REFERENCES ADMIN(AID) NOT NULL,
    ABTITLE VARCHAR2(1000) NOT NULL,
    ABCONTENT VARCHAR2(4000),
    ABDATE DATE DEFAULT SYSDATE NOT NULL,
    ABIP VARCHAR2(20) NOT NULL,
    QBID NUMBER(10) REFERENCES QBOARD(QBID) NOT NULL);
    
--  [11] ADMIN  --

DROP TABLE ADMIN;

CREATE TABLE ADMIN(
    AID VARCHAR2(100) PRIMARY KEY,
    APW VARCHAR2(100) NOT NULL,
    ANAME VARCHAR2(100) NOT NULL
);