-- DROPPING TABLE
DROP TABLE MEMBER CASCADE CONSTRAINTS;
DROP TABLE QBOARD CASCADE CONSTRAINTS;
DROP TABLE ABOARD CASCADE CONSTRAINTS;
DROP TABLE ADMIN CASCADE CONSTRAINTS;
DROP TABLE FOLLOW CASCADE CONSTRAINTS;
-- DROPPING SEQUENCE
DROP SEQUENCE QBOARD_SEQ;
DROP SEQUENCE ABOARD_SEQ;
DROP SEQUENCE FOLLOW_SEQ;


-- [1] MEMBER
CREATE TABLE MEMBER(
    MID VARCHAR2(100) PRIMARY KEY,
    MPW VARCHAR2(100) NOT NULL,
    MNAME VARCHAR2(100) NOT NULL,
    MEMAIL VARCHAR2(100) NOT NULL,
    MRDATE DATE DEFAULT SYSDATE NOT NULL
);
SELECT * FROM MEMBER;
-- [1] MEMBER - DUMMY_DATA


COMMIT;
-- [1] MEMBER - DML
-- loginMember
SELECT * FROM MEMBER WHERE MID='aaa';
-- confirmMid
SELECT COUNT(*) FROM MEMBER WHERE MID='aaa'; -- 중복된 아이디의 경우 1
SELECT COUNT(*) FROM MEMBER WHERE MID='ZZZ'; -- 중복된 아이디가 아닌 경우 0
-- confirmMemail
SELECT COUNT(*) FROM MEMBER WHERE MEMAIL='yoonseokoo@gmail.com'; -- 중복된 이메일의 경우 1
SELECT COUNT(*) FROM MEMBER WHERE MEMAIL='owen6113@naver.com'; -- 중복된 이메일이 아닌 경우 0
-- joinMember
INSERT INTO MEMBER (MID, MPW, MNAME, MEMAIL)
    VALUES ('choi', '123', 'jinyeoung', 'jinyeoung@naver.com');
-- getMember
SELECT * FROM MEMBER WHERE MID='aaa';
-- modifyMember
UPDATE MEMBER SET MPW='123',
                  MNAME='최진영',
                  MEMAIL='choi@naver.com'
            WHERE MID='choi';
-- searchMid(mname, memail)
SELECT * FROM MEMBER WHERE MNAME='unie' AND MEMAIL='yoonseokoo@gmail.com';
-- searchMemail(mid, mname, memail)
SELECT * FROM MEMBER WHERE MID='owen6113' AND MNAME='김빈' AND MEMAIL='owen6113@naver.com';
-- searchMidMemberList
SELECT * FROM (SELECT ROWNUM RN, A.* 
            FROM (SELECT MID, MNAME FROM MEMBER WHERE NOT MID='owen6113' AND MID LIKE '%'||'1'||'%'ORDER BY MID DESC) A)
        WHERE RN BETWEEN 1 AND 20; 
-- searchMnameMemberList
SELECT * FROM (SELECT ROWNUM RN, A.* 
            FROM (SELECT MID, MNAME FROM MEMBER WHERE NOT MID='owen6113' AND MNAME LIKE '%'||'북'||'%'ORDER BY MID DESC) A)
        WHERE RN BETWEEN 1 AND 20; 
-- [2] QBOARD
CREATE SEQUENCE QBOARD_SEQ MAXVALUE 9999999999 NOCYCLE NOCACHE;
CREATE TABLE QBOARD(
    QBID NUMBER(10) PRIMARY KEY,
    MID VARCHAR2(100) REFERENCES MEMBER(MID) NOT NULL,
    QBTITLE VARCHAR2(1000) NOT NULL,
    QBCONTENT VARCHAR2(4000),
    QBRDATE DATE DEFAULT SYSDATE NOT NULL,
    QBIP VARCHAR2(20) NOT NULL,
    QBREPLYCHECK NUMBER(1) DEFAULT 0 NOT NULL
);
SELECT * FROM QBOARD;
ROLLBACK;
COMMIT;
-- [2] QBOARD - DUMMY_DATA
INSERT INTO QBOARD (QBID, MID, QBTITLE, QBCONTENT, QBIP)
    VALUES (QBOARD_SEQ.NEXTVAL, 'aaa','정산하기에 오류가 있는 것 같습니다','정산하기 버튼을 눌렀는데 저는 받기 버튼이 안떠서 돈을 받을 수 없어요 ㅜㅜ', '127.0.0.1');
INSERT INTO QBOARD (QBID, MID, QBTITLE, QBCONTENT, QBIP)
    VALUES (QBOARD_SEQ.NEXTVAL, 'bbb','정말 잘쓰고 있습니다','이 사이트 정말 좋은 것 같아요!', '127.0.0.3');
INSERT INTO QBOARD (QBID, MID, QBTITLE, QBCONTENT, QBIP)
    VALUES (QBOARD_SEQ.NEXTVAL, 'ccc','문의드립니다!','회원탈퇴 후에 정보는 몇년동안 남아있나요?', '127.0.0.5');
-- [2] QBOARD - DML
-- writeQboard(문의글 작성하기)
INSERT INTO QBOARD (QBID, MID, QBTITLE, QBCONTENT, QBIP)
    VALUES (QBOARD_SEQ.NEXTVAL, 'choi','친구 추가는 어덯게 하나요?','친구추가 버튼이 보이지 않아요', '127.0.0.10');
-- modifyQboard(문의글 수정하기)
UPDATE QBOARD SET QBTITLE='서비스가 정말 별로에요',
                  QBCONTENT='여러분 이 사이트 절대 쓰지마세요',
                  QBIP='127.0.0.4'
            WHERE QBID=2 AND QBREPLYCHECK=0;
-- viewQboard(문의글 상세보기)
SELECT * FROM QBOARD WHERE QBID=1;
-- listQboardForMember(멤버를 위한 문의글 목록)
SELECT * FROM (SELECT ROWNUM RN, A.* 
            FROM (SELECT * FROM QBOARD ORDER BY QBRDATE DESC) A)
        WHERE RN BETWEEN 1 AND 10;   
-- getQboardTotCntForMember(멤버를 위한 문의글 갯수 얻기)
SELECT COUNT(*) FROM QBOARD;
-- listQboardForMe(자신이 작성한 문의글 목록)
SELECT * FROM (SELECT ROWNUM RN, A.* 
            FROM (SELECT * FROM QBOARD WHERE MID='aaa' ORDER BY QBRDATE DESC) A)
        WHERE RN BETWEEN 1 AND 10; 
-- getQboardTotCntForMe(자신이 작성한 문의글 갯수 얻기)
SELECT COUNT(*) FROM QBOARD WHERE MID='aaa';
-- listUncheckedQboardForAdmin(관리자를 위한 답글처리가 안 된 문의글 목록)
SELECT * FROM (SELECT ROWNUM RN, A.* 
            FROM (SELECT * FROM QBOARD WHERE QBREPLYCHECK=0 ORDER BY QBRDATE DESC) A)
        WHERE RN BETWEEN 1 AND 10; 
-- getUncheckedQboardTotCntForAdmin(관리자를 위한 답글처리가 안 된 문의글 갯수 얻기)
SELECT COUNT(*) FROM QBOARD WHERE QBREPLYCHECK=0;
-- listCheckedQboardForAdmin(관리자를 위한 답글처리가 된 문의글 목록)
SELECT * FROM (SELECT ROWNUM RN, A.* 
            FROM (SELECT * FROM QBOARD WHERE QBREPLYCHECK=1 ORDER BY QBRDATE DESC) A)
        WHERE RN BETWEEN 1 AND 10; 
-- getCheckedQboardTotCntForAdmin(관리자를 위한 답글처리가 된 문의글 갯수 얻기)
SELECT COUNT(*) FROM QBOARD WHERE QBREPLYCHECK=1;
-- updateQboardReplyCheck(답글처리가 된 문의글의 처리상태 바꾸기)
UPDATE QBOARD SET QBREPLYCHECK=1 WHERE QBID=1;



-- [3] ABOARD
CREATE SEQUENCE ABOARD_SEQ MAXVALUE 9999999999 NOCYCLE NOCACHE;
CREATE TABLE ABOARD(
    ABID NUMBER(10) PRIMARY KEY,
    AID VARCHAR2(100) REFERENCES ADMIN(AID) NOT NULL,
    ABTITLE VARCHAR2(1000) NOT NULL,
    ABCONTENT VARCHAR2(4000),
    ABDATE DATE DEFAULT SYSDATE NOT NULL,
    ABIP VARCHAR2(20) NOT NULL,
    QBID NUMBER(10) REFERENCES QBOARD(QBID) NOT NULL
);
SELECT * FROM ABOARD;
DELETE FROM ABOARD WHERE ABID=3;
COMMIT;
ROLLBACK;
-- [3] ABOARD - DUMMY_DATA
INSERT INTO ABOARD (ABID, AID, ABTITLE, ABCONTENT, ABIP, QBID)
    VALUES (ABOARD_SEQ.NEXTVAL, 'admin1','관리자 답글','저희 시스템 오류가 있는 것 같습니다. 잠시만 기다려주세요', '192.168.10.30', 1);

-- [3] ABOARD - DML
-- writeAboard(답변글 작성하기)
INSERT INTO ABOARD (ABID, AID, ABTITLE, ABCONTENT, ABIP, QBID)
    VALUES (ABOARD_SEQ.NEXTVAL, 'admin1','관리자 답글','저희 시스템 오류가 있는 것 같습니다. 잠시만 기다려주세요', '192.168.10.30', 3);
-- viewAboard(답변글 상세보기) -> 문의글 상세보기 페이지로 들어가면 답변글 상세보기가 존재
SELECT * FROM ABOARD WHERE QBID=1;
-- modifyAboard(답변글 수정하기)
UPDATE ABOARD SET ABTITLE='해결되었습니다',
                  ABCONTENT='여러분 이 사이트 절대 쓰지마세요',
                  ABIP='127.0.0.4'
            WHERE ABID=1;
ROLLBACK;
-- [4] ADMIN
CREATE TABLE ADMIN(
    AID VARCHAR2(100) PRIMARY KEY,
    APW VARCHAR2(100) NOT NULL,
    ANAME VARCHAR2(100) NOT NULL
);
SELECT * FROM ADMIN;
COMMIT;
-- [4] ADMIN - DUMMY_DATA
INSERT INTO ADMIN(AID, APW, ANAME) VALUES ('admin1', '1', '관리자1');
INSERT INTO ADMIN(AID, APW, ANAME) VALUES ('admin2', '2', '관리자2');

SELECT * FROM USER_TABLES;

-- [5] FOLLOW
CREATE SEQUENCE FOLLOW_SEQ MAXVALUE 9999999999 NOCYCLE NOCACHE;
CREATE TABLE FOLLOW(
    FID NUMBER(10) PRIMARY KEY,
    FROM_MID VARCHAR2(100) REFERENCES MEMBER(MID) NOT NULL,
    TO_MID VARCHAR2(100) REFERENCES MEMBER(MID) NOT NULL
);
SELECT * FROM FOLLOW;
SELECT * FROM MEMBER;
-- [5] FOLLOW - DML
-- followMember (팔로우 하기)
INSERT INTO FOLLOW(FID, FROM_MID, TO_MID) VALUES (FOLLOW_SEQ.NEXTVAL, 'aaa', 'bbb');
INSERT INTO FOLLOW(FID, FROM_MID, TO_MID) VALUES (FOLLOW_SEQ.NEXTVAL, 'aaa', 'a127');
INSERT INTO FOLLOW(FID, FROM_MID, TO_MID) VALUES (FOLLOW_SEQ.NEXTVAL, 'aaa', 'ccc');
INSERT INTO FOLLOW(FID, FROM_MID, TO_MID) VALUES (FOLLOW_SEQ.NEXTVAL, 'aaa', 'ddd');
INSERT INTO FOLLOW(FID, FROM_MID, TO_MID) VALUES (FOLLOW_SEQ.NEXTVAL, 'aaa', 'owen6113');
INSERT INTO FOLLOW(FID, FROM_MID, TO_MID) VALUES (FOLLOW_SEQ.NEXTVAL, 'bbb', 'aaa');
INSERT INTO FOLLOW(FID, FROM_MID, TO_MID) VALUES (FOLLOW_SEQ.NEXTVAL, 'bbb', 'owen6113');
INSERT INTO FOLLOW(FID, FROM_MID, TO_MID) VALUES (FOLLOW_SEQ.NEXTVAL, 'ccc', 'aaa');

-- myFollowingList (내가 팔로잉하는 사람들 목록) 
SELECT TO_MID FROM FOLLOW WHERE FROM_MID='aaa' ORDER BY TO_MID;
-- myFollowerList (나를 팔로우하는 사람들 목록)
SELECT FROM_MID FROM FOLLOW WHERE TO_MID='aaa' ORDER BY FROM_MID;
-- unfollowMember (언팔로우 하기)
DELETE FROM FOLLOW WHERE FROM_MID='aaa' AND TO_MID='owen6113';


SELECT FROM_MID,TO_MID FROM FOLLOW WHERE FROM_MID='aaa' OR TO_MID='aaa';

-- [6] NOTIFICATION
DROP SEQUENCE NOTI_SEQ;
DROP TABLE NOTIFICATION;
CREATE SEQUENCE NOTI_SEQ MAXVALUE 9999999999 NOCYCLE NOCACHE;
CREATE TABLE NOTIFICATION(
	NOTID NUMBER(10) PRIMARY KEY, -- 시퀀스 : NOTI_SEQ MAXVALUE 9999999999 NOCYCLE NOCACHE;
	NOTSENDER VARCHAR2(100) REFERENCES MEMBER(MID) NOT NULL,
	NOTRECEIVER VARCHAR2(100) REFERENCES MEMBER(MID) NOT NULL,
	NOTCONTENT VARCHAR2(4000) NOT NULL,
	NOTDATE DATE DEFAULT SYSDATE NOT NULL, 
	NOTKIND NUMBER(1) NOT NULL, -- > 알림의 종류: 친구요청(0) / 그룹초대 요청(1)
	NOTCHECK NUMBER(1) DEFAULT 0 NOT NULL --> 알림 확인 여부 
);
SELECT * FROM NOTIFICATION;
COMMIT;
-- 아이디 'aaa'가 아이디 'bbb'를 팔로우해서 <aaa님이 bbb님을 팔로우하기 시작했습니다>가 'bbb' 알림창에 발생!
INSERT INTO NOTIFICATION (NOTID, NOTSENDER, NOTRECEIVER, NOTCONTENT, NOTKIND) VALUES (NOTI_SEQ.NEXTVAL, 'aaa', 'bbb', '님이 회원님(현재 로그인한 회원)을 팔로우하기 시작했습니다', 0); 

-- [7] NOTIFICATION HISTORY
DROP SEQUENCE NOTH_SEQ;
DROP TABLE NOTIFICATIONHISTORY;
CREATE SEQUENCE NOTH_SEQ MAXVALUE 9999999999 NOCYCLE NOCACHE;
CREATE TABLE NOTIFICATIONHISTORY(
	NOTHID NUMBER(10) PRIMARY KEY, -- 시퀀스 : NOTIH_SEQ	 MAXVALUE 9999999999 NOCYCLE NOCACHE;
	NOTSENDER VARCHAR2(100) REFERENCES MEMBER(MID) NOT NULL,
	NOTRECEIVER VARCHAR2(100) REFERENCES MEMBER(MID) NOT NULL,
	NOTCONTENT VARCHAR2(4000) NOT NULL,
	NOTDATE DATE DEFAULT SYSDATE NOT NULL, 
	NOTKIND NUMBER(1) NOT NULL, --> 알림의 종류: 친구요청(0) / 그룹초대 요청(1)
	NOTCHECK NUMBER(1) DEFAULT 0 NOT NULL --> 알림 확인 여부
);
SELECT * FROM NOTIFICATIONHISTORY;
ROLLBACK;
-- 2) 'aaa'가 'bbb'를 팔로우 함으로써 'bbb' 알림창에 팔로우 알람을 발생시킴 => NOTIFICATION_HISTORY 테이블에 INSERT문 : INSERT INTO NOTIFICATION () VALUES (); 
INSERT INTO NOTIFICATIONHISTORY (NOTHID, NOTSENDER, NOTRECEIVER, NOTCONTENT, NOTKIND) VALUES (NOTH_SEQ.NEXTVAL, 'aaa', 'bbb', '님이 회원님(현재 로그인한 회원)을 팔로우하기 시작했습니다', 0); 
INSERT INTO NOTIFICATION (NOTID, NOTSENDER, NOTRECEIVER, NOTCONTENT, NOTKIND) VALUES (NOTI_SEQ.NEXTVAL, 'bbb', 'aaa', '님이 회원님(현재 로그인한 회원)을 팔로우하기 시작했습니다', 0); 
INSERT INTO NOTIFICATION (NOTID, NOTSENDER, NOTRECEIVER, NOTCONTENT, NOTKIND) VALUES (NOTI_SEQ.NEXTVAL, 'aaa', 'ccc', '님이 회원님(현재 로그인한 회원)을 팔로우하기 시작했습니다', 0);
INSERT INTO NOTIFICATION (NOTID, NOTSENDER, NOTRECEIVER, NOTCONTENT, NOTKIND) VALUES (NOTI_SEQ.NEXTVAL, 'ccc', 'aaa', '님이 회원님(현재 로그인한 회원)을 팔로우하기 시작했습니다', 0);
INSERT INTO NOTIFICATION (NOTID, NOTSENDER, NOTRECEIVER, NOTCONTENT, NOTKIND) VALUES (NOTI_SEQ.NEXTVAL, 'bbb', 'ccc', '님이 회원님(현재 로그인한 회원)을 팔로우하기 시작했습니다', 0); 
-- 3) 해당 알람을 NOTIFICATION_HISTORY 테이블에 저장한다 => NOTIFICATION_HISTORY INSERT문 : INSERT INTO NOTIFICATION_HISTORY () VALUES ();
INSERT INTO NOTIFICATION_HISTORY 
    (SELECT NOTIH_SEQ.NEXTVAL, NOTID, NOTSENDER, NOTRECEIVER, NOTCONTENT, NOTDATE, NOTKIND, NOTCHECK 
        FROM NOTIFICATION
            WHERE (NOT NOTID=(SELECT NOTID FROM NOTIFICATION_HISTORY)) OR (NOT EXISTS(SELECT NOTID FROM NOTIFICATION_HISTORY)));



-- 4) 'bbb'가 알림창 버튼을 누른다 A(지금까지 쌓인 알림 리스트 보기) => SELECT * FROM NOTIFICATION_HISTORY WHERE notreceiver = 'bbb' AND notcheck=0;
SELECT * FROM NOTIFICATIONHISTORY WHERE NOTRECEIVER = 'bbb' AND NOTCHECK=0;

-- 5) 'bbb'가 알림창 버튼을 누른다 B(해당 알림 리스트의 읽음여부를 바꾸기) => UPDATE NOTIFICATION_HISTORY SET notcheck=1 WHERE notreceiver ='bbb' AND notcheck=0;
UPDATE NOTIFICATION_HISTORY SET NOTCHECK=1 WHERE NOTRECEIVER ='bbb' AND NOTCHECK=0;
-- 6) 'bbb'가 알림창 버튼을 누른다 C(NOTIFICATION 테이블에서 notsender가 'bbb'인 것들을 지우기) => DELETE NOTIFICATION WHERE notreceiver ='bbb';
DELETE NOTIFICATION WHERE NOTRECEIVER ='bbb';
-- 7) 알림창에 쌓인 알림들 숫자 가져오기 => SELECT COUNT(*) FROM NOTIFICATION WHERE notreceiver ='bbb';
SELECT COUNT(*) FROM NOTIFICATION WHERE NOTRECEIVER ='bbb' AND NOTCHECK=0;
SELECT COUNT(*) FROM NOTIFICATION WHERE NOTRECEIVER ='aaa' AND NOTCHECK=0;


-- 2) 'aaa'가 'bbb'를 그룹에 초대함으로써 'bbb' 알림창에 그룹초대 알람을 발생시킴 => NOTIFICATION 테이블에 INSERT문 : INSERT INTO NOTIFICATION () VALUES (); 
INSERT INTO NOTIFICATION (NOTID, NOTSENDER, NOTRECEIVER, NOTCONTENT, NOTKIND) VALUES (NOTI_SEQ.NEXTVAL, 'aaa', 'bbb', '님이 회원님을 그룹에 초대했습니다', 1); 
INSERT INTO NOTIFICATION (NOTID, NOTSENDER, NOTRECEIVER, NOTCONTENT, NOTKIND) VALUES (NOTI_SEQ.NEXTVAL, 'aaa', 'ccc', '님이 회원님을 그룹에 초대했습니다', 1);
-- 3) 해당 알람을 NOTIFICATION_HISTORY 테이블에 저장한다 => NOTIFICATION_HISTORY INSERT문 : INSERT INTO NOTIFICATION_HISTORY () VALUES ();
INSERT INTO NOTIFICATION_HISTORY 
    (SELECT NOTIH_SEQ.NEXTVAL, NOTID, NOTSENDER, NOTRECEIVER, NOTCONTENT, NOTDATE, NOTKIND, NOTCHECK 
        FROM NOTIFICATION N
            WHERE NOT N.NOTID=(SELECT NOTID FROM NOTIFICATION_HISTORY));  
ROLLBACK;
-- 4) 'bbb'가 알림창 버튼을 누른다 A(지금까지 쌓인 알림 리스트 보기) => SELECT * FROM NOTIFICATION_HISTORY WHERE notreceiver = 'bbb' AND notcheck=0;
SELECT * FROM NOTIFICATION_HISTORY WHERE NOTRECEIVER = 'bbb' AND NOTCHECK=0;
-- 5) 'bbb'가 알림창 버튼을 누른다 B(해당 알림 리스트의 읽음여부를 바꾸기) => UPDATE NOTIFICATION_HISTORY SET notcheck=1 WHERE notreceiver ='bbb' AND notcheck=0;
UPDATE NOTIFICATION_HISTORY SET NOTCHECK=1 WHERE NOTRECEIVER ='bbb' AND NOTCHECK=0;
-- 6) 'bbb'가 알림창 버튼을 누른다 C(NOTIFICATION 테이블에서 notsender가 'bbb'인 것들을 지우기) => DELETE NOTIFICATION WHERE notreceiver ='bbb';
DELETE NOTIFICATION WHERE NOTRECEIVER ='bbb';
-- 7) 알림창에 쌓인 알림들 숫자 가져오기 => SELECT COUNT(*) FROM NOTIFICATION WHERE notreceiver ='bbb';
SELECT COUNT(*) FROM NOTIFICATION WHERE NOTRECEIVER ='bbb';
SELECT * FROM NOTIFICATION;
SELECT * FROM NOTIFICATIONHISTORY;

-- 1) 'aaa'가 'bbb'를 팔로우해서 알람이 생성 => NOTIFICATION 테이블에 INSERT
INSERT INTO NOTIFICATION (NOTID, NOTSENDER, NOTRECEIVER, NOTCONTENT, NOTKIND) VALUES (NOTI_SEQ.NEXTVAL, 'aaa', 'bbb', '님이 회원님(현재 로그인한 회원)을 팔로우하기 시작했습니다', 0); 
INSERT INTO NOTIFICATION (NOTID, NOTSENDER, NOTRECEIVER, NOTCONTENT, NOTKIND) VALUES (NOTI_SEQ.NEXTVAL, 'aaa', 'ccc', '님이 회원님(현재 로그인한 회원)을 팔로우하기 시작했습니다', 0); 
-- 2) 위의 데이터가 바로 NOTIFICATION_HISTORY 테이블에 INSERT
INSERT INTO NOTIFICATION_HISTORY 
    (SELECT NOTIH_SEQ.NEXTVAL, NOTID, NOTSENDER, NOTRECEIVER, NOTCONTENT, NOTDATE, NOTKIND, NOTCHECK 
        FROM NOTIFICATION);
-- 3) NOTIFICATION 테이블에 있는 해당 정보 DELETE
DELETE FROM NOTIFICATION;

-- 4) 사용자가 읽지 않은 알람수 가져오기
SELECT COUNT(*) FROM NOTIFICATIONHISTORY WHERE NOTRECEIVER='ccc' AND NOTCHECK=0; 

-- 5) 사용자가 읽지 않은 알람 리스트 가져오기
SELECT * FROM NOTIFICATIONHISTORY WHERE NOTRECEIVER='ccc' AND NOTCHECK=0;

-- 6) 알람리스트를 불러와서 사용자가 확인 했을 때 NOTCHECK를 1로 업데이트 시키기
UPDATE NOTIFICATIONHISTORY SET NOTCHECK=1 WHERE NOTRECEIVER='ccc' AND NOTCHECK=0;

-- 1) 'aaa'가 'bbb'를 그룹에 초대해서 알람이 생성 => NOTIFICATION 테이블에 INSERT
INSERT INTO NOTIFICATION (NOTID, NOTSENDER, NOTRECEIVER, NOTCONTENT, NOTKIND) VALUES (NOTI_SEQ.NEXTVAL, 'aaa', 'bbb', '님이 회원님을 그룹에 초대했습니다', 1); 
-- 2) 위의 데이터가 바로 NOTIFICATION_HISTORY 테이블에 INSERT
INSERT INTO NOTIFICATION_HISTORY 
    (SELECT NOTIH_SEQ.NEXTVAL, NOTID, NOTSENDER, NOTRECEIVER, NOTCONTENT, NOTDATE, NOTKIND, NOTCHECK 
        FROM NOTIFICATION);
        
-- 3) NOTIFICATION 테이블에 있는 해당 정보 DELETE
DELETE FROM NOTIFICATION;

-- 4) 사용자가 읽지 않은 알람수 가져오기
SELECT COUNT(*) FROM NOTIFICATIONHISTORY WHERE NOTRECEIVER='bbb' AND NOTCHECK=0; 

-- 5) 사용자가 읽지 않은 알람 리스트 가져오기
SELECT * FROM NOTIFICATION_HISTORY WHERE NOTRECEIVER='bbb' AND NOTCHECK=0;
SELECT * FROM (SELECT ROWNUM RN, A.* 
            FROM (SELECT * FROM NOTIFICATIONHISTORY WHERE NOTRECEIVER='bbb' AND NOTCHECK=0 ORDER BY NOTDATE DESC) A)
        WHERE RN BETWEEN 1 AND 20; 
        
-- 6) 사용자의 모든 알람수 가져오기
SELECT COUNT(*) FROM NOTIFICATIONHISTORY WHERE NOTRECEIVER='bbb'; 

-- 7) 사용자가 모든 알람 리스트 가져오기
SELECT * FROM (SELECT ROWNUM RN, A.* 
            FROM (SELECT * FROM NOTIFICATIONHISTORY WHERE NOTRECEIVER='bbb' ORDER BY NOTDATE DESC) A)
        WHERE RN BETWEEN 1 AND 20; 
-- 8) 알람리스트를 불러와서 사용자가 확인 했을 때 NOTCHECK를 1로 업데이트 시키기
UPDATE NOTIFICATION_HISTORY SET NOTCHECK=1 WHERE NOTRECEIVER='bbb' AND NOTCHECK=0;

SELECT * FROM USER_TABLES;
SELECT * FROM ALL_TAB_COLUMNS WHERE TABLE_NAME = 'NOTIFICATIONHISTORY';
