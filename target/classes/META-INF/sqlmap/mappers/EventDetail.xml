<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.lec.unie.dao.EventDetailDao">
	<resultMap type="EventDetail" id="EventDetailResult">
		<result property="edid" column="edid"/>
		<result property="eid" column="eid"/>
		<result property="mid" column="mid"/>
		<result property="edshare" column="edshare"/>
	</resultMap>
	
	
	<!-- 이벤트에 정보 추가 추가 (자기가 냈을때) -->
	<insert id="insertEventDetailPayer" parameterType="EventDetail">
		INSERT INTO EVENTDETAIL (EDID, EID, MID, EDSHARE)
    		VALUES (EVENTDETAIL_SEQ.NEXTVAL, #{eid}, #{mid}, ((SELECT EAMOUNT FROM EVENT WHERE EID=#{eid})/(SELECT ECOUNT FROM EVENT WHERE EID=#{eid})))
    </insert>
	
	<!-- 이벤트에 정보 추가 추가 (자기가 안냈을때) -->
	<insert id="insertEventDetail" parameterType="String">
		INSERT INTO EVENTDETAIL (EDID, EID, MID, EDSHARE)
    		VALUES (EVENTDETAIL_SEQ.NEXTVAL, EVENT_SEQ.CURRVAL, #{mid}, -1*((SELECT EAMOUNT FROM EVENT WHERE EID=(SELECT MAX(EID)FROM EVENT))/(SELECT ECOUNT FROM EVENT WHERE EID=(SELECT MAX(EID)FROM EVENT))))
       
	</insert>

	<delete id="deleteEventDetail" parameterType="EventDetail">
		   DELETE FROM EVENTDETAIL WHERE EID=#{eid}
	</delete>
	<select id="printMidList" parameterType="int" resultMap="EventDetailResult">
		SELECT M.MID FROM MEMBER M, GROUPDETAIL GD, GROUPS G WHERE M.MID=GD.MID AND G.MID != GD.MID AND GD.GID=G.GID AND GD.GID=#{gid}
	</select>
</mapper>